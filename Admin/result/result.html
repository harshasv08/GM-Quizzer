<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- ------------------------------jquery--------------------------------------- -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

  <!-- ---------------------------------------- html TO excel------------------------------------------------ -->
  <script src="https://cdn.jsdelivr.net/gh/linways/table-to-excel@v1.0.4/dist/tableToExcel.js"></script>


  <script src="https://kit.fontawesome.com/a076d05399.js"></script>
  <!--Get your code at fontawesome.com-->
  <script src="https://www.gstatic.com/firebasejs/8.5.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.5.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.5.0/firebase-auth.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.js"></script>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">


  <!-- -----------------------------------------icon -------------------------------------------->
  <link rel="icon" href="../../logo.png" type="image/jpg" radius>


  <!--Get your code at fontawesome.com-->
  <title>Gm-Quizzer</title>

  <meta name='viewport' content='width=device-width, initial-scale=1'>
  <link rel='stylesheet' type='text/css' media='screen' href='res.css'>


  <style>
    body {
      /* background-image: url("res.jpg"); */
      /* background-color: rgb(95, 137, 153); */
      /* background: linear-gradient(rgb(95, 137, 153) 0%, grey 70%); */
      background: linear-gradient(rgb(95, 137, 153) 0%, skyblue 60%, white 95%) fixed;
      /* background-size: cover; */

      height: 100%;
    }
  </style>

</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark ">
    <div class="container-fluid">


      <a class="navbar-brand" href="../../index.html"> <i class="fas fa-graduation-cap"
          style="font-size: 30px;"></i></a>
      <div style="display: flex; flex-direction:column; color: white; margin-right: 20px;"><strong
          style="font-size: 20px;">Gm-Quizzer </strong> <span style="font-size: 10px;">K-CET Mock Test</span></div>


      <!-- <img src="<i class="bi bi-exclude"></i>" alt="" width="10" height="20" class="d-inline-block align-text-top"> -->
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a id="phy" class="nav-link " aria-current="page" href="../../index.html">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="../../about.html">About us</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="../../contact.html">Contact us</a>
          </li>
          <li class="nav-item">
            <button class="btn btn-outline-light" type="submit" onclick="logout()"
              style="position:absolute; top:10px; right: 30px;">Logout</button>
          </li>


        </ul>

      </div>
    </div>
  </nav>

  <br>
  <!-- <button  class="btn btn-primary" id="download" onclick="clickdown()">Download</button>
   -->
  <!-- thie is a example -->

  <h1  style="margin-left: 45%;">Results</h1>

  <button class="btn btn-success" id="download" onclick="clickdown()"
    title="Double-click on download button to download as pdf">Download as pdf</button>

  <button class="btn btn-success" id="btnExport" onclick="exportReportToExcel()">Download as Excel</button>

  <br><br>
  <div style="text-align: center; padding-top: 40px;" id="tble">

    
    <table>
      <thead>
        <tr >
          <td style="background-color: #5fc9c3;"><b>Test Name</b></td>
          <td colspan="8" id="test" style="text-align: center; font-weight: bold; background-color: #a5e7e4; "> Test name</td>
        </tr>
        <tr  >
          <td style="background-color: #5fc9c3;"><b>Start time</b></td>
          <td  colspan="8" id="strt" style="text-align: center; font-weight: bold;  background-color: #c0e9e6;">start time</td>
        </tr>
        
        <tr>
          <td style="background-color: #5fc9c3;"><b>End time</b></td>
          <td colspan="8" id="end" style="text-align: center; font-weight: bold;  background-color: #a5e7e4;"> end time</td>
        </tr>
      </thead>
      <thead>

        <th>Rank</th>
        <th>Name</th>
        <th>Email</th>
        <th>Phone</th>
        <th>College</th>
        <th>Physics</th>
        <th>Chemistry</th>
        <th>Mathematics</th>

        <th>Obtained marks</th>
      </thead>
      <tbody id="tbody">
        <tr>
          <!-- <td>1</td>
            <td>jai shree Ram</td>
            <td>jsr@gmail.com</td>
            <td>78</td>
            <td>98</td>
            <td>100</td> -->

        </tr>
      </tbody>
    </table>
  </div>







  <script>
    function logout() {
      auth.signOut().then(function () {
        window.location.replace('../../index.html');
      });
    }
  </script>


  <script>
    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    var firebaseConfig = {
      apiKey: "AIzaSyC65CsmH-QelfcNdmXqLeGQYvncXd_w4M0",
      authDomain: "quizapp-85a5f.firebaseapp.com",
      databaseURL: "https://quizapp-85a5f-default-rtdb.firebaseio.com",
      projectId: "quizapp-85a5f",
      storageBucket: "quizapp-85a5f.appspot.com",
      messagingSenderId: "761715522436",
      appId: "1:761715522436:web:4d1b2aa493cb31af4b7bd1",
      measurementId: "G-H7FKXHRSSM"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    db.settings({ timestampsInSnapshots: true });

  </script>

  <script>
    function selectalldata() {
      db.collection('users').orderBy('Totalmarks', "desc").get().then(snapshot => {
        var Sno = 0;
        snapshot.docs.forEach(doc => {
          Sno = ++Sno;
          var Name = doc.data().Username;
          var Email = doc.data().Email;
          var Totalmarks = doc.data().Totalmarks;
          var Physics, Chemistry, Mathematics;
          var phone = doc.data().Phone;
          var college = doc.data().College;
          if (doc.data().Physics != '')
            Physics = doc.data().Physics;

          else
            Physics = '0';


          if (doc.data().Chemistry != '')
            Chemistry = doc.data().Chemistry;

          else
            Chemistry = '0';



          if (doc.data().Mathematics != '')
            Mathematics = doc.data().Mathematics;

          else
            Mathematics = '0';


          if (doc.data().Totalmarks != '')
            Totalmarks = doc.data().Totalmarks;

          else
            Totalmarks = '0';


          AddItemsToTable(Sno, Name, Email, Physics, Chemistry, Mathematics, Totalmarks, phone,college);
        });
      });


      db.collection('Timestamp').get().then(snapshot => {
        
        snapshot.docs.forEach(doc => {
          document.getElementById("strt").innerHTML = doc.data().start_time.toDate();
          document.getElementById("end").innerHTML = doc.data().end_time.toDate();
          document.getElementById("test").innerHTML = doc.data().test_name;
        });
      });

    }
    window.onload = selectalldata;

    function AddItemsToTable(Sno, Name, Email, Physics, Chemistry, Mathematics, Totalmarks, phone,college) {
      // var sno=0;
      var tbody1 = document.getElementById('tbody');
      var trow = document.createElement('tr');
      var td1 = document.createElement('td');
      var td2 = document.createElement('td');
      var td3 = document.createElement('td');
      var td4 = document.createElement('td');
      var td5 = document.createElement('td');
      var td6 = document.createElement('td');
      var td7 = document.createElement('td');
      var td8 = document.createElement('td');
      var td9 = document.createElement('td');
      td1.innerHTML = Sno;
      td2.innerHTML = Name;
      td3.innerHTML = Email;
      td4.innerHTML = Physics;
      td5.innerHTML = Chemistry;
      td6.innerHTML = Mathematics;
      td7.innerHTML = Totalmarks;
      td8.innerHTML = phone;
      td9.innerHTML = college;
      trow.appendChild(td1);
      trow.appendChild(td2);
      trow.appendChild(td3);
      trow.appendChild(td8);
      trow.appendChild(td9);
      trow.appendChild(td4);
      trow.appendChild(td5);
      trow.appendChild(td6);
      trow.appendChild(td7);


      tbody1.appendChild(trow);
    }

    function clickdown() {
      document.getElementById("download").addEventListener('click', () => {
        const tabdown = document.getElementById("tble");
        console.log(tabdown);

        var opt = {
          margin: 0,
          filename: 'Result.pdf',
          image: { type: 'jpeg', quality: 0.98 },
          html2canvas: { scale: 2 },
          jsPDF: { unit: 'in', format: 'letter', orientation: 'landscape' }
        };

        html2pdf().from(tabdown).set(opt).save();
      });
    }
  </script>

  <script>


    function exportReportToExcel() {
      let table = document.getElementsByTagName("table"); // you can use document.getElementById('tableId') as well by providing id to the table tag
      TableToExcel.convert(table[0], { // html code may contain multiple tables so here we are refering to 1st table tag
        name: `Result.xlsx`, // fileName you could use any name
        sheet: {
          name: 'Sheet 1' // sheetName
        }
      });
    }
  </script>


</body>

</html>

<!-- quality = 0.98 -->